# MCP (Model Context Protocol) 開発ルール

このファイルは、`D:\BMS\mcp` ディレクトリにおける Model Context Protocol (MCP) サーバーの開発に関するルールとガイドラインを定めたものです。

# システムプロンプト

## 共通ルール
- 日本語で応対
- 「D:\BMS\mcp」直下にフォルダを作るときは必ずai_agent_ruleファイルを「D:\BMS\ai_agent_rule_format.md」をフォーマットにして作成
- 依頼するほとんどのタスクはコーディングとは関係ないことを考慮
- powershellでは「&&」を使用しない
- 絶対に生成時に省略行為は行わない
- すべてのタスク実行時にlog/ai_agent_ruleに従って作業ログを記録する

## テスト駆動処理
- 必ずタスクはテストドリブンで処理を行う
- タスクに合わせた詳細なテスト項目を事前に作成
- テスト用に別途ファイルを作成
- テスト粒度は細かく設定し、クリアするまで自動で反復

## ワークフロー

重要：必ず各ディレクトリのai_agent_ruleを参照し、ワークフローを把握すること:
  workflow: 
    mcp: |
      mcpディレクトリは、Model Context Protocol (MCP) サーバーの開発に関するルールやガイドラインを定めた場所です。
      ここでは、MCPサーバーの実装、テスト、ドキュメント作成、デプロイ、運用、トラブルシューティング、拡張性、サンプルコード、その他開発に関する情報を管理します。
    timing: |
      mcpでの作業を開始する際には、以下の手順で進めてください：
      
      1. 開発手順に従って作業を開始します。
         - 開発環境のセットアップ
         - MCPサーバーの実装
         - テスト
         - ドキュメントの作成
         - デプロイ
      
      2. コーディング規約、テスト、セキュリティ、運用、トラブルシューティング、拡張性、サンプルコード、その他の項目を確認します。
         - 各項目に沿って作業を進めます。
      
      3. 定められたディレクトリ構造に従って作業を開始します：
         - 必要なフォルダの作成
         - ファイルの命名規則の遵守
         - フォルダ階層の維持
      
      4. 作業ログを適切に記録します：
         - タスク開始時の記録
         - 進捗状況の更新
         - 問題点や課題の記録
         - 完了時の記録

## 開発手順

1. 開発環境のセットアップ
   - 必要なソフトウェアのインストール
   - 開発用リポジトリのクローン
   - 依存関係のインストール

2. MCPサーバーの実装
   - `create-typescript-server` ツールを使用したプロジェクトの作成
   - サーバーロジックの実装
   - ツールとリソースの定義

3. テスト
   - 単体テストの実施
   - 結合テストの実施
   - パフォーマンステストの実施

4. ドキュメントの作成
   - APIドキュメントの作成
   - ユーザーガイドの作成
   - サンプルコードの作成

5. デプロイ
   - 本番環境へのデプロイ
   - サーバーの起動

## コーディング規約

- TypeScriptを使用
- [リンタの設定](https://typescript-eslint.io/)に従う
- コメントを適切に記述
- わかりやすい変数名、関数名を使用

## テスト

- すべての機能に対して単体テストを作成
- 重要な機能に対して結合テストを作成
- パフォーマンス要件がある場合は、パフォーマンステストを実施

## セキュリティ

- 既知の脆弱性に対する対策を実施
- 入力値の検証を徹底
- 認証・認可を適切に実装

## 運用

- ログの監視
- エラーの検知と対応
- 定期的なメンテナンス

## トラブルシューティング

- エラーログの確認方法
- デバッグ方法
- よくある問題と解決策

## 拡張性

- 新しいツールやリソースの追加方法
- 既存のサーバーの拡張方法

## サンプルコード

- 基本的なサーバーのサンプル
- ツールとリソースのサンプル

## その他

- 開発者間でのコミュニケーション方法
- 質問や相談ができる場所

## log/ - タスクログ管理
タスクの進捗管理と記録のためのディレクトリ

### ディレクトリ構造
```
mcp/log/
├── ai_agent_rule.md
└── YYYYMMDD/
    ├── task_description.md  # タスクの詳細説明
    └── progress.md         # 進捗状況の記録
```

### 使用方法
1. 新規タスク開始時：YYYYMMDDフォーマットでフォルダを作成
2. 各タスクフォルダには以下を含める：
   - task_description.md：タスクの詳細説明
   - progress.md：進捗状況の記録

### 重要：タスクフロー
1. タスク開始時に必ずlogディレクトリにタスクログを記録
2. タスクの詳細説明をtask_description.mdに記載
3. タスクの進捗状況をprogress.mdに随時記録
4. タスク完了時に最終進捗を記録